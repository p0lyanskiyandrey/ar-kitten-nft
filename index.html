<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>AR –ö–æ—Ç–µ–Ω–æ–∫ —Å Motion Tracking</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            overflow: hidden;
            touch-action: none;
        }
        
        #video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 1;
        }
        
        #ui {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 3;
            pointer-events: none;
        }
        
        #info {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            background: rgba(0,0,0,0.85);
            color: white;
            padding: 15px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
            pointer-events: auto;
            font-size: 14px;
            border: 1px solid rgba(155, 89, 182, 0.3);
        }
        
        #controls {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: rgba(255,255,255,0.95);
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            backdrop-filter: blur(10px);
            pointer-events: auto;
        }
        
        .btn {
            padding: 12px 18px;
            margin: 4px;
            border: none;
            border-radius: 8px;
            background: linear-gradient(135deg, #9B59B6 0%, #8E44AD 100%);
            color: white;
            font-size: 13px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(155, 89, 182, 0.3);
        }
        
        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(155, 89, 182, 0.4);
        }
        
        .btn:active {
            transform: scale(0.95);
        }
        
        #motion-status {
            position: absolute;
            top: 50%;
            right: 15px;
            transform: translateY(-50%);
            background: rgba(0,0,0,0.75);
            color: white;
            padding: 12px;
            border-radius: 8px;
            font-size: 11px;
            pointer-events: auto;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            z-index: 5;
            pointer-events: auto;
            border: 2px solid #9B59B6;
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.05); }
            100% { opacity: 1; transform: scale(1); }
        }
        
        .motion-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 5px;
            animation: blink 1s infinite;
        }
        
        .motion-active {
            background: #00FF88;
        }
        
        .motion-inactive {
            background: #FF6B6B;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }
        
        #calibration {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(155, 89, 182, 0.9);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            z-index: 6;
            display: none;
        }
        
        @media (max-width: 600px) {
            .btn {
                padding: 10px 14px;
                font-size: 11px;
                margin: 3px;
            }
            
            #info, #controls {
                margin: 10px;
                padding: 12px;
            }
        }
    </style>
</head>
<body>
    <video id="video" autoplay playsinline muted></video>
    
    <div id="ui">
        <div id="loading">
            <div class="pulse">üì±</div>
            <p>–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è AR Motion Tracking...</p>
            <p style="font-size: 12px;">–†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ –∏ –¥–∞—Ç—á–∏–∫–∞–º</p>
        </div>
        
        <div id="calibration">
            <h3>üìê –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞</h3>
            <p>–î–µ—Ä–∂–∏—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω —Ä–æ–≤–Ω–æ –∏ –Ω–∞–∂–º–∏—Ç–µ "–ì–æ—Ç–æ–≤–æ"</p>
            <button class="btn" onclick="finishCalibration()">‚úÖ –ì–æ—Ç–æ–≤–æ</button>
        </div>
        
        <div id="info" style="display: none;">
            <h3>üéØ AR Motion Tracking</h3>
            <p><strong>–î–≤–∏–≥–∞–π—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–º</strong> - –∫–æ—Ç–µ–Ω–æ–∫ –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–∞ –º–µ—Å—Ç–µ!</p>
            <p>‚Ä¢ –ö–æ—Ç—è—Ç–∞: <span id="kitten-count">0</span></p>
            <p>‚Ä¢ <strong>–ù–∞–∂–º–∏—Ç–µ —ç–∫—Ä–∞–Ω</strong> –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –∫–æ—Ç–µ–Ω–∫–∞</p>
            <p>‚Ä¢ Motion: <span id="motion-indicator">üî¥ –û—Ç–∫–ª—é—á–µ–Ω</span></p>
        </div>
        
        <div id="motion-status" style="display: none;">
            <div><span class="motion-indicator motion-active"></span>–î–≤–∏–∂–µ–Ω–∏–µ X: <span id="motion-x">0¬∞</span></div>
            <div><span class="motion-indicator motion-active"></span>–î–≤–∏–∂–µ–Ω–∏–µ Y: <span id="motion-y">0¬∞</span></div>
            <div><span class="motion-indicator motion-active"></span>–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ: <span id="distance">2.0–º</span></div>
            <div><span class="motion-indicator motion-active"></span>–ö–æ—Ç—è—Ç–∞: <span id="motion-kittens">0</span></div>
        </div>
        
        <div id="controls" style="display: none;">
            <button class="btn" onclick="addKitten()">üê± –†–∞–∑–º–µ—Å—Ç–∏—Ç—å –∫–æ—Ç–µ–Ω–∫–∞</button>
            <button class="btn" onclick="enableMotion()">üì± –í–∫–ª—é—á–∏—Ç—å —Ç—Ä–µ–∫–∏–Ω–≥</button>
            <button class="btn" onclick="resetPosition()">üîÑ –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞</button>
            <button class="btn" onclick="clearAll()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
            <button class="btn" onclick="takePhoto()">üì∏ –§–æ—Ç–æ</button>
        </div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let video, scene, camera, renderer;
        let kittens = [];
        let motionEnabled = false;
        let calibrated = false;
        
        // –î–∞–Ω–Ω—ã–µ –¥–≤–∏–∂–µ–Ω–∏—è
        let deviceOrientation = {
            alpha: 0, // Z-axis (–∫–æ–º–ø–∞—Å)
            beta: 0,  // X-axis (—Ç–∏–ª—Ç –≤–ø–µ—Ä–µ–¥/–Ω–∞–∑–∞–¥)
            gamma: 0  // Y-axis (—Ç–∏–ª—Ç –≤–ª–µ–≤–æ/–≤–ø—Ä–∞–≤–æ)
        };
        
        let calibrationOffset = {
            alpha: 0,
            beta: 0,
            gamma: 0
        };
        
        let cameraPosition = {
            x: 0,
            y: 0,
            z: 3
        };
        
        // UI —ç–ª–µ–º–µ–Ω—Ç—ã
        const loadingDiv = document.getElementById('loading');
        const calibrationDiv = document.getElementById('calibration');
        const infoDiv = document.getElementById('info');
        const controlsDiv = document.getElementById('controls');
        const motionStatus = document.getElementById('motion-status');
        const kittenCountSpan = document.getElementById('kitten-count');
        const motionIndicator = document.getElementById('motion-indicator');
        const motionX = document.getElementById('motion-x');
        const motionY = document.getElementById('motion-y');
        const distanceSpan = document.getElementById('distance');
        const motionKittens = document.getElementById('motion-kittens');
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        async function init() {
            try {
                // –ó–∞–ø—É—Å–∫ –∫–∞–º–µ—Ä—ã
                video = document.getElementById('video');
                await startCamera();
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è 3D
                init3D();
                
                // –ó–∞–ø—Ä–æ—Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –Ω–∞ –¥–∞—Ç—á–∏–∫–∏ –¥–≤–∏–∂–µ–Ω–∏—è
                await requestMotionPermissions();
                
                // –°–æ–±—ã—Ç–∏—è
                setupEvents();
                
                // –ó–∞–ø—É—Å–∫ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
                animate();
                
                // –°–∫—Ä—ã—Ç–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –ø–æ–∫–∞–∑ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏
                loadingDiv.style.display = 'none';
                calibrationDiv.style.display = 'block';
                
                console.log('AR Motion Tracking –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!');
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
                loadingDiv.innerHTML = `
                    <div>‚ùå</div>
                    <p>–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏</p>
                    <p style="font-size: 12px;">${error.message}</p>
                    <button class="btn" onclick="location.reload()">üîÑ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å</button>
                `;
            }
        }
        
        async function startCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: { 
                        facingMode: 'environment',
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    },
                    audio: false
                });
                
                video.srcObject = stream;
                
                return new Promise((resolve) => {
                    video.onloadedmetadata = () => {
                        video.play();
                        resolve();
                    };
                });
                
            } catch (error) {
                throw new Error('–ö–∞–º–µ—Ä–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞: ' + error.message);
            }
        }
        
        async function requestMotionPermissions() {
            // –ó–∞–ø—Ä–æ—Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –¥–ª—è iOS 13+
            if (typeof DeviceOrientationEvent.requestPermission === 'function') {
                try {
                    const permission = await DeviceOrientationEvent.requestPermission();
                    if (permission !== 'granted') {
                        throw new Error('–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –¥–∞—Ç—á–∏–∫–∏ –¥–≤–∏–∂–µ–Ω–∏—è –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ');
                    }
                } catch (error) {
                    console.warn('–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π:', error);
                }
            }
        }
        
        function init3D() {
            // –°—Ü–µ–Ω–∞
            scene = new THREE.Scene();
            
            // –ö–∞–º–µ—Ä–∞
            camera = new THREE.PerspectiveCamera(
                75,
                window.innerWidth / window.innerHeight,
                0.1,
                100
            );
            
            camera.position.set(cameraPosition.x, cameraPosition.y, cameraPosition.z);
            
            // –†–µ–Ω–¥–µ—Ä–µ—Ä
            renderer = new THREE.WebGLRenderer({ 
                alpha: true,
                antialias: true
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.domElement.style.position = 'absolute';
            renderer.domElement.style.top = '0';
            renderer.domElement.style.left = '0';
            renderer.domElement.style.zIndex = '2';
            renderer.domElement.style.pointerEvents = 'none';
            document.body.appendChild(renderer.domElement);
            
            // –û—Å–≤–µ—â–µ–Ω–∏–µ
            setupLighting();
        }
        
        function setupLighting() {
            // –û–∫—Ä—É–∂–∞—é—â–∏–π —Å–≤–µ—Ç
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.7);
            scene.add(ambientLight);
            
            // –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —Å–≤–µ—Ç
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(5, 5, 5);
            scene.add(directionalLight);
            
            // –¢–æ—á–µ—á–Ω—ã–π —Å–≤–µ—Ç
            const pointLight = new THREE.PointLight(0x9B59B6, 0.6, 10);
            scene.add(pointLight);
        }
        
        function setupEvents() {
            // –î–∞—Ç—á–∏–∫ –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
            window.addEventListener('deviceorientation', function(event) {
                if (motionEnabled && calibrated) {
                    deviceOrientation.alpha = (event.alpha || 0) - calibrationOffset.alpha;
                    deviceOrientation.beta = (event.beta || 0) - calibrationOffset.beta;
                    deviceOrientation.gamma = (event.gamma || 0) - calibrationOffset.gamma;
                    
                    updateCameraFromMotion();
                    updateMotionDisplay();
                }
            });
            
            // –ö–ª–∏–∫ –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –∫–æ—Ç–µ–Ω–∫–∞
            document.addEventListener('click', function(event) {
                if (event.target.classList.contains('btn') || 
                    event.target.closest('#controls') || 
                    event.target.closest('#info') ||
                    event.target.closest('#calibration')) {
                    return;
                }
                
                addKitten();
            });
            
            // –¢–∞—á —Å–æ–±—ã—Ç–∏—è
            document.addEventListener('touchstart', function(event) {
                if (event.target.classList.contains('btn') || 
                    event.target.closest('#controls') || 
                    event.target.closest('#info') ||
                    event.target.closest('#calibration')) {
                    return;
                }
                
                event.preventDefault();
                addKitten();
            }, { passive: false });
        }
        
        function finishCalibration() {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â—É—é –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—é –∫–∞–∫ –±–∞–∑–æ–≤—É—é
            calibrationOffset.alpha = deviceOrientation.alpha || 0;
            calibrationOffset.beta = deviceOrientation.beta || 0;
            calibrationOffset.gamma = deviceOrientation.gamma || 0;
            
            calibrated = true;
            
            calibrationDiv.style.display = 'none';
            infoDiv.style.display = 'block';
            controlsDiv.style.display = 'block';
            
            // –î–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–≤–æ–≥–æ –∫–æ—Ç–µ–Ω–∫–∞
            setTimeout(() => {
                addKitten();
            }, 500);
        }
        
        function enableMotion() {
            motionEnabled = !motionEnabled;
            
            if (motionEnabled) {
                motionIndicator.innerHTML = 'üü¢ –í–∫–ª—é—á–µ–Ω';
                motionStatus.style.display = 'block';
                event.target.textContent = '‚è∏Ô∏è –û—Ç–∫–ª—é—á–∏—Ç—å —Ç—Ä–µ–∫–∏–Ω–≥';
            } else {
                motionIndicator.innerHTML = 'üî¥ –û—Ç–∫–ª—é—á–µ–Ω';
                motionStatus.style.display = 'none';
                event.target.textContent = 'üì± –í–∫–ª—é—á–∏—Ç—å —Ç—Ä–µ–∫–∏–Ω–≥';
            }
        }
        
        function updateCameraFromMotion() {
            if (!motionEnabled || !calibrated) return;
            
            // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º —É–≥–ª—ã —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –≤ —Ä–∞–¥–∏–∞–Ω—ã
            const alphaRad = deviceOrientation.alpha * Math.PI / 180;
            const betaRad = deviceOrientation.beta * Math.PI / 180;
            const gammaRad = deviceOrientation.gamma * Math.PI / 180;
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –ø–æ–≤–æ—Ä–æ—Ç –∫–∞–º–µ—Ä—ã
            camera.rotation.set(
                betaRad,  // X-axis (–≤–≤–µ—Ä—Ö/–≤–Ω–∏–∑)
                alphaRad, // Y-axis (–ø–æ–≤–æ—Ä–æ—Ç)
                gammaRad  // Z-axis (–Ω–∞–∫–ª–æ–Ω)
            );
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –∫–∞–º–µ—Ä—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–≤–∏–∂–µ–Ω–∏—è
            const moveSpeed = 0.02;
            cameraPosition.x += Math.sin(alphaRad) * moveSpeed;
            cameraPosition.z += Math.cos(alphaRad) * moveSpeed;
            
            camera.position.set(cameraPosition.x, cameraPosition.y, cameraPosition.z);
        }
        
        function updateMotionDisplay() {
            motionX.textContent = Math.round(deviceOrientation.alpha) + '¬∞';
            motionY.textContent = Math.round(deviceOrientation.beta) + '¬∞';
            
            if (kittens.length > 0) {
                const distance = camera.position.distanceTo(kittens[0].position);
                distanceSpan.textContent = distance.toFixed(1) + '–º';
            }
            
            motionKittens.textContent = kittens.length;
        }
        
        function addKitten() {
            // –°–æ–∑–¥–∞–µ–º –∫–æ—Ç–µ–Ω–∫–∞ –≤ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏ –º–∏—Ä–∞
            const kittenGroup = new THREE.Group();
            
            // –†–∞–∑–º–µ—â–∞–µ–º –≤ —Ä–∞–∑–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏—è—Ö
            const angle = kittens.length * (Math.PI * 2 / 5); // 5 –ø–æ–∑–∏—Ü–∏–π –ø–æ –∫—Ä—É–≥—É
            const radius = 2;
            
            kittenGroup.position.set(
                Math.sin(angle) * radius,
                (Math.random() - 0.5) * 2,
                Math.cos(angle) * radius
            );
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ–∫—Å—Ç—É—Ä—ã
            const loader = new THREE.TextureLoader();
            loader.load('kitten.jpg', 
                function(texture) {
                    console.log('‚úÖ Motion-tracked –∫–æ—Ç–µ–Ω–æ–∫ —Å–æ–∑–¥–∞–Ω!');
                    createKittenMesh(kittenGroup, texture);
                },
                undefined,
                function(error) {
                    console.log('–°–æ–∑–¥–∞–µ–º fallback –∫–æ—Ç–µ–Ω–∫–∞');
                    createKittenMesh(kittenGroup, null);
                }
            );
            
            scene.add(kittenGroup);
            kittens.push(kittenGroup);
            updateKittenCount();
        }
        
        function createKittenMesh(group, texture) {
            // –û—Å–Ω–æ–≤–Ω–∞—è –ø–ª–æ—Å–∫–æ—Å—Ç—å –∫–æ—Ç–µ–Ω–∫–∞
            const geometry = new THREE.PlaneGeometry(1, 1);
            
            let material;
            if (texture) {
                material = new THREE.MeshLambertMaterial({ 
                    map: texture,
                    transparent: true,
                    side: THREE.DoubleSide
                });
            } else {
                material = new THREE.MeshLambertMaterial({ 
                    color: 0x9B59B6,
                    transparent: true,
                    opacity: 0.8
                });
            }
            
            const kittenMesh = new THREE.Mesh(geometry, material);
            group.add(kittenMesh);
            
            // –†–∞–º–∫–∞
            const frameGeometry = new THREE.RingGeometry(0.52, 0.55, 32);
            const frameMaterial = new THREE.MeshBasicMaterial({ 
                color: 0xFFD700,
                transparent: true,
                opacity: 0.8
            });
            const frame = new THREE.Mesh(frameGeometry, frameMaterial);
            frame.position.z = -0.01;
            group.add(frame);
            
            // –õ–µ–≥–∫–æ–µ –≤—Ä–∞—â–µ–Ω–∏–µ –¥–ª—è –∫—Ä–∞—Å–æ—Ç—ã
            group.userData.rotationSpeed = 0.005;
        }
        
        function resetPosition() {
            cameraPosition.x = 0;
            cameraPosition.y = 0;
            cameraPosition.z = 3;
            
            camera.position.set(cameraPosition.x, cameraPosition.y, cameraPosition.z);
            camera.rotation.set(0, 0, 0);
            
            // –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞
            calibrationDiv.style.display = 'block';
            calibrated = false;
        }
        
        function clearAll() {
            kittens.forEach(kitten => {
                scene.remove(kitten);
            });
            kittens = [];
            updateKittenCount();
        }
        
        function takePhoto() {
            // –°–æ–∑–¥–∞–µ–º composite –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth || 1280;
            canvas.height = video.videoHeight || 720;
            const ctx = canvas.getContext('2d');
            
            // –†–∏—Å—É–µ–º –≤–∏–¥–µ–æ
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            // –†–∏—Å—É–µ–º 3D –ø–æ–≤–µ—Ä—Ö (—É–ø—Ä–æ—â–µ–Ω–Ω–æ)
            ctx.fillStyle = 'rgba(155, 89, 182, 0.8)';
            ctx.font = '48px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('üê± AR Photo!', canvas.width / 2, canvas.height / 2);
            
            // –°–∫–∞—á–∏–≤–∞–µ–º
            const link = document.createElement('a');
            link.download = 'motion-ar-kitten.png';
            link.href = canvas.toDataURL();
            link.click();
            
            showNotification('üì∏ AR-—Ñ–æ—Ç–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ!');
        }
        
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(0,0,0,0.8);
                color: white;
                padding: 15px 25px;
                border-radius: 10px;
                z-index: 10000;
                font-size: 16px;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (document.body.contains(notification)) {
                    document.body.removeChild(notification);
                }
            }, 2000);
        }
        
        function updateKittenCount() {
            kittenCountSpan.textContent = kittens.length;
        }
        
        function animate() {
            requestAnimationFrame(animate);
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –∫–æ—Ç—è—Ç
            kittens.forEach(kitten => {
                if (kitten.userData.rotationSpeed) {
                    kitten.rotation.y += kitten.userData.rotationSpeed;
                }
            });
            
            // –†–µ–Ω–¥–µ—Ä
            renderer.render(scene, camera);
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ—Å–∞–π–∑–∞
        window.addEventListener('resize', function() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
        
        // –ó–∞–ø—É—Å–∫
        window.addEventListener('load', init);
        
        console.log('üåü AR —Å Motion Tracking –∑–∞–≥—Ä—É–∂–µ–Ω!');
    </script>
</body>
</html>
